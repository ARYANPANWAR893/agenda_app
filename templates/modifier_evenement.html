{% extends 'base.html' %}

{% block content %}
<div class="container">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card shadow
        {% if event.classe == 'Direction' %} border-primary
        {% elif event.classe == 'P么le Compta' %} border-success
        {% elif event.classe == 'P么le Social' %} border-warning
        {% elif event.classe == 'P么le juridique' %} border-danger
        {% elif event.classe == 'P么le Communication' %} border-info
        {% elif event.classe.startswith('Assistance') %} border-secondary
        {% else %} border-primary
        {% endif %}">
        <div class="card-header text-white
          {% if event.classe == 'Direction' %}bg-primary
          {% elif event.classe == 'P么le Compta' %}bg-success
          {% elif event.classe == 'P么le Social' %}bg-warning text-dark
          {% elif event.classe == 'P么le juridique' %}bg-danger
          {% elif event.classe == 'P么le Communication' %}bg-info
          {% elif event.classe.startswith('Assistance') %}bg-secondary
          {% else %}bg-primary
          {% endif %}">
          Modifier la t芒che
          {% if event.classe %}
            <span class="badge ms-2
              {% if event.classe == 'Direction' %}bg-light text-primary
              {% elif event.classe == 'P么le Compta' %}bg-light text-success
              {% elif event.classe == 'P么le Social' %}bg-light text-warning
              {% elif event.classe == 'P么le juridique' %}bg-light text-danger
              {% elif event.classe == 'P么le Communication' %}bg-light text-info
              {% elif event.classe.startswith('Assistance') %}bg-light text-secondary
              {% else %}bg-secondary
              {% endif %}">
              {{ event.classe }}
            </span>
          {% endif %}
        </div>
        <div class="card-body">

          <!-- Formulaire de modification -->
          <form method="POST" enctype="multipart/form-data">
            <div class="mb-3">
              <label class="form-label">Titre</label>
              <input type="text" class="form-control" name="title" value="{{ event.title }}" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Description</label>
              <textarea class="form-control" name="description">{{ event.description }}</textarea>
            </div>
            <div class="mb-3">
              <label class="form-label">Date & Heure</label>
              <input type="datetime-local" class="form-control" name="start" value="{{ event.start[:16]|replace(' ', 'T') }}" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Classe</label>
              <select class="form-select" name="classe" required>
                <option value="">-- S茅lectionner un p么le --</option>
                <option value="Direction" {% if event.classe == 'Direction' %}selected{% endif %}>Direction</option>
                <option value="P么le Compta" {% if event.classe == 'P么le Compta' %}selected{% endif %}>P么le Compta</option>
                <option value="P么le Social" {% if event.classe == 'P么le Social' %}selected{% endif %}>P么le Social</option>
                <option value="P么le juridique" {% if event.classe == 'P么le juridique' %}selected{% endif %}>P么le juridique</option>
                <option value="P么le Communication" {% if event.classe == 'P么le Communication' %}selected{% endif %}>P么le Communication</option>
                <option value="Assistance Compta" {% if event.classe == 'Assistance Compta' %}selected{% endif %}>Assistance Compta</option>
                <option value="Assistance Paie" {% if event.classe == 'Assistance Paie' %}selected{% endif %}>Assistance Paie</option>
                <option value="Assistance juridique" {% if event.classe == 'Assistance juridique' %}selected{% endif %}>Assistance juridique</option>
                <option value="Assistance Communication" {% if event.classe == 'Assistance Communication' %}selected{% endif %}>Assistance Communication</option>
              </select>
            </div>
           
            <div class="mb-3">
              <label class="form-label">Priorit茅</label>
              <select class="form-select" name="priorite">
                <option value="Basse" {% if event.priorite == 'Basse' %}selected{% endif %}>Basse</option>
                <option value="Moyenne" {% if event.priorite == 'Moyenne' or not event.priorite %}selected{% endif %}>Moyenne</option>
                <option value="Haute" {% if event.priorite == 'Haute' %}selected{% endif %}>Haute</option>
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label">Statut</label>
              <select class="form-select" name="statut" required>
                <option value=" faire" {% if event.statut == " faire" %}selected{% endif %}> faire</option>
                <option value="en cours" {% if event.statut == "en cours" %}selected{% endif %}>En cours</option>
                <option value="termin茅" {% if event.statut == "termin茅" %}selected{% endif %}>Termin茅</option>
                <option value="valid茅" {% if event.statut == "valid茅" %}selected{% endif %}>Valid茅</option>
              </select>
            </div>
            <!-- Champ fichier + affichage pi猫ce jointe existante -->
            <div class="mb-3">
              <label class="form-label">Changer / Ajouter une pi猫ce jointe (PDF, image...)</label>
              <input type="file" class="form-control" name="attachment" accept=".pdf,.png,.jpg,.jpeg,.gif,.bmp">
              {% if event.attachment %}
                <div class="mt-2">
                  <a href="{{ url_for('static', filename='uploads/' ~ event.attachment) }}" target="_blank" class="btn btn-sm btn-info">
                     Voir la pi猫ce jointe actuelle
                  </a>
                </div>
              {% endif %}
            </div>
            <div class="mb-3 form-check">
              <input type="checkbox" class="form-check-input" id="apply_to_all" name="apply_to_all">
              <label class="form-check-label" for="apply_to_all">Appliquer cette modification  tous les 茅v茅nements r茅currents</label>
            </div><br>
            <button type="submit" class="btn btn-success">Enregistrer</button>
            <a href="{{ url_for('evenements') }}" class="btn btn-secondary ms-2">Annuler</a>
          </form>
          <!-- Fin formulaire modification -->


        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
